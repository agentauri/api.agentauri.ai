# =============================================================================
# ERC-8004 Backend - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values:
#   cp .env.example .env
# =============================================================================

# =============================================================================
# DATABASE (PostgreSQL + TimescaleDB)
# =============================================================================
# Development (with TLS, self-signed certificate)
DATABASE_URL=postgresql://postgres:YOUR_PASSWORD@localhost:5432/erc8004_backend?sslmode=require&sslrootcert=./docker/postgres/certs/root.crt

# Production (with TLS, CA-signed certificate, full verification)
# DATABASE_URL=postgresql://postgres:YOUR_PASSWORD@prod-db.example.com:5432/erc8004_backend?sslmode=verify-full&sslrootcert=/path/to/ca-cert.crt

# Connection pool settings (FIX 4.3 - Production Readiness)
# These values control the PostgreSQL connection pool used by SQLx
# Proper tuning prevents connection exhaustion and optimizes performance
#
# DB_MAX_CONNECTIONS: Maximum simultaneous database connections
#   - Development: 20 (sufficient for local testing)
#   - Staging: 50 (moderate load testing)
#   - Production: 100-200 (depends on workload and Postgres max_connections)
#   - Formula: min(CPU cores * 2, Postgres max_connections / num_instances)
#   - Too low: Connection pool exhaustion under load
#   - Too high: Resource waste, Postgres connection limit reached
#
# DB_MIN_CONNECTIONS: Minimum idle connections kept alive
#   - Development: 5 (low overhead)
#   - Staging: 10 (faster cold starts)
#   - Production: 20-50 (avoid connection establishment latency)
#   - Formula: max_connections * 0.2 to 0.5
#   - Too low: Latency spikes when acquiring connections
#   - Too high: Wasted resources for idle instances
#
# Connection timeout: 30 seconds (SQLx default, not configurable via env)
# Idle timeout: 10 minutes (SQLx default)
# Max lifetime: No limit (connections live until closed or server restart)
#
# Performance notes:
# - Each connection uses ~10MB RAM in Postgres (estimate for monitoring)
# - Event processor needs ~10-20 concurrent connections under normal load
# - Burst capacity: max_connections should handle 2-3x normal load
#
DB_USER=postgres
DB_PASSWORD=YOUR_PASSWORD
DB_NAME=erc8004_backend
DB_MAX_CONNECTIONS=20
DB_MIN_CONNECTIONS=5

# Encryption key for column-level encryption (PII data)
# CRITICAL: Store in secrets manager (AWS Secrets Manager, HashiCorp Vault)
# NEVER commit actual key to version control!
DB_ENCRYPTION_KEY=REPLACE_WITH_KEY_FROM_SECRETS_MANAGER

# =============================================================================
# REDIS
# =============================================================================
REDIS_URL=redis://localhost:6379

# State caching configuration
STATE_CACHE_ENABLED=true
STATE_CACHE_TTL_SECS=300

# =============================================================================
# JWT AUTHENTICATION
# =============================================================================
JWT_SECRET=your_jwt_secret_here_change_in_production

# =============================================================================
# CORS CONFIGURATION
# =============================================================================
# Comma-separated list of allowed origins for Cross-Origin Resource Sharing
# Development default: http://localhost:3000,http://localhost:8080
# Production: MUST be set explicitly with HTTPS URLs only
# Example: CORS_ALLOWED_ORIGINS=https://app.example.com,https://admin.example.com
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080

# Environment setting (affects CORS and HSTS behavior)
# Set to "production" to enforce HTTPS-only CORS origins
ENVIRONMENT=development

# =============================================================================
# RPC PROVIDER URLS - MULTI-PROVIDER FAILOVER CONFIGURATION
# =============================================================================
# Ponder uses advanced failover with:
# - Load balancing between Primary Pool (Alchemy + Infura) and Fallback Pool (QuickNode + Ankr)
# - Smart ranking: auto-promotes faster/more stable providers every 10 seconds
# - Automatic retry with exponential backoff (3 attempts: 1s, 2s, 4s)
# - Rate limiting per provider to respect free-tier limits
#
# Configuration modes (based on number of providers):
# - 1 provider: Direct connection (fastest, no resilience)
# - 2-3 providers: Fallback with smart ranking
# - 4+ providers: Load-balanced failover with smart ranking (RECOMMENDED)
#
# Replace YOUR_KEY with your actual API keys from each provider
# =============================================================================

# =============================================================================
# ETHEREUM SEPOLIA TESTNET (ChainID: 11155111)
# =============================================================================
ETHEREUM_SEPOLIA_RPC_ALCHEMY=https://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
ETHEREUM_SEPOLIA_RPC_INFURA=https://sepolia.infura.io/v3/YOUR_INFURA_KEY
ETHEREUM_SEPOLIA_RPC_QUIKNODE=https://YOUR-ENDPOINT.ethereum-sepolia.quiknode.pro/YOUR_QUIKNODE_KEY
ETHEREUM_SEPOLIA_RPC_ANKR=https://rpc.ankr.com/eth_sepolia/YOUR_ANKR_KEY

# Legacy single-URL fallback (optional, for backward compatibility)
# ETHEREUM_SEPOLIA_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY

# =============================================================================
# BASE SEPOLIA TESTNET (ChainID: 84532)
# =============================================================================
BASE_SEPOLIA_RPC_ALCHEMY=https://base-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
BASE_SEPOLIA_RPC_INFURA=https://base-sepolia.infura.io/v3/YOUR_INFURA_KEY
BASE_SEPOLIA_RPC_QUIKNODE=https://YOUR-ENDPOINT.base-sepolia.quiknode.pro/YOUR_QUIKNODE_KEY
BASE_SEPOLIA_RPC_ANKR=https://rpc.ankr.com/base_sepolia/YOUR_ANKR_KEY

# =============================================================================
# LINEA SEPOLIA TESTNET (ChainID: 59141)
# =============================================================================
LINEA_SEPOLIA_RPC_ALCHEMY=https://linea-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
LINEA_SEPOLIA_RPC_INFURA=https://linea-sepolia.infura.io/v3/YOUR_INFURA_KEY
LINEA_SEPOLIA_RPC_QUIKNODE=https://YOUR-ENDPOINT.lens-testnet.quiknode.pro/YOUR_QUIKNODE_KEY
# Note: Ankr doesn't support Linea Sepolia yet

# =============================================================================
# ETHEREUM MAINNET (ChainID: 1)
# =============================================================================
ETHEREUM_MAINNET_RPC_ALCHEMY=https://eth-mainnet.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
ETHEREUM_MAINNET_RPC_INFURA=https://mainnet.infura.io/v3/YOUR_INFURA_KEY
ETHEREUM_MAINNET_RPC_QUIKNODE=https://YOUR-ENDPOINT.quiknode.pro/YOUR_QUIKNODE_KEY
ETHEREUM_MAINNET_RPC_ANKR=https://rpc.ankr.com/eth/YOUR_ANKR_KEY

# =============================================================================
# BASE MAINNET (ChainID: 8453)
# =============================================================================
BASE_MAINNET_RPC_ALCHEMY=https://base-mainnet.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
BASE_MAINNET_RPC_INFURA=https://base-mainnet.infura.io/v3/YOUR_INFURA_KEY
BASE_MAINNET_RPC_QUIKNODE=https://YOUR-ENDPOINT.base-mainnet.quiknode.pro/YOUR_QUIKNODE_KEY
BASE_MAINNET_RPC_ANKR=https://rpc.ankr.com/base/YOUR_ANKR_KEY

# =============================================================================
# LINEA MAINNET (ChainID: 59144)
# =============================================================================
LINEA_MAINNET_RPC_ALCHEMY=https://linea-mainnet.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
LINEA_MAINNET_RPC_INFURA=https://linea-mainnet.infura.io/v3/YOUR_INFURA_KEY
LINEA_MAINNET_RPC_QUIKNODE=https://YOUR-ENDPOINT.linea-mainnet.quiknode.pro/YOUR_QUIKNODE_KEY
# Note: Ankr doesn't support Linea Mainnet yet

# =============================================================================
# POLYGON AMOY TESTNET (ChainID: 80002) - NOT IN PONDER YET
# =============================================================================
# POLYGON_AMOY_RPC_ALCHEMY=https://polygon-amoy.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
# POLYGON_AMOY_RPC_INFURA=https://polygon-amoy.infura.io/v3/YOUR_INFURA_KEY
# POLYGON_AMOY_RPC_QUIKNODE=https://YOUR-ENDPOINT.polygon-amoy.quiknode.pro/YOUR_QUIKNODE_KEY
# POLYGON_AMOY_RPC_ANKR=https://rpc.ankr.com/polygon_amoy/YOUR_ANKR_KEY

# =============================================================================
# RPC RATE LIMITING (Optional - defaults provided)
# =============================================================================
# These values respect free-tier limits for each provider
# Adjust based on your plan (free, growth, enterprise)
RPC_RATE_LIMIT_ALCHEMY=25      # requests/second (free tier safe)
RPC_RATE_LIMIT_INFURA=20       # requests/second (free tier safe)
RPC_RATE_LIMIT_QUIKNODE=25     # requests/second (free tier safe)
RPC_RATE_LIMIT_ANKR=30         # requests/second (free tier safe)

# =============================================================================
# RPC SMART RANKING CONFIGURATION (Optional - defaults provided)
# =============================================================================
# Auto-ranking promotes faster/more stable providers
RPC_RANK_INTERVAL=10000        # Health check interval (ms) - default: 10 seconds
RPC_RANK_SAMPLE_COUNT=10       # Number of test requests per check - default: 10
RPC_RANK_TIMEOUT=2000          # Health check timeout (ms) - default: 2 seconds
# Weights: 30% latency + 70% stability (uptime)

# =============================================================================
# CONTRACT ADDRESSES - TESTNETS
# =============================================================================

# ETHEREUM SEPOLIA (ChainID: 11155111)
ETHEREUM_SEPOLIA_IDENTITY_ADDRESS=0x8004a6090Cd10A7288092483047B097295Fb8847
ETHEREUM_SEPOLIA_REPUTATION_ADDRESS=0x8004B8FD1A363aa02fDC07635C0c5F94f6Af5B7E
ETHEREUM_SEPOLIA_VALIDATION_ADDRESS=0x8004CB39f29c09145F24Ad9dDe2A108C1A2cdfC5
ETHEREUM_SEPOLIA_START_BLOCK=0

# BASE SEPOLIA (ChainID: 84532)
BASE_SEPOLIA_IDENTITY_ADDRESS=0x8004AA63c570c570eBF15376c0dB199918BFe9Fb
BASE_SEPOLIA_REPUTATION_ADDRESS=0x8004bd8daB57f14Ed299135749a5CB5c42d341BF
BASE_SEPOLIA_VALIDATION_ADDRESS=0x8004C269D0A5647E51E121FeB226200ECE932d55
BASE_SEPOLIA_START_BLOCK=0

# LINEA SEPOLIA (ChainID: 59141)
LINEA_SEPOLIA_IDENTITY_ADDRESS=0x8004aa7C931bCE1233973a0C6A667f73F66282e7
LINEA_SEPOLIA_REPUTATION_ADDRESS=0x8004bd8483b99310df121c46ED8858616b2Bba02
LINEA_SEPOLIA_VALIDATION_ADDRESS=0x8004c44d1EFdd699B2A26e781eF7F77c56A9a4EB
LINEA_SEPOLIA_START_BLOCK=0

# POLYGON AMOY (ChainID: 80002) - NOT IN PONDER YET
# POLYGON_AMOY_IDENTITY_ADDRESS=0x8004ad19E14B9e0654f73353e8a0B600D46C2898
# POLYGON_AMOY_REPUTATION_ADDRESS=0x8004B12F4C2B42d00c46479e859C92e39044C930
# POLYGON_AMOY_VALIDATION_ADDRESS=0x8004C11C213ff7BaD36489bcBDF947ba5eee289B
# POLYGON_AMOY_START_BLOCK=0

# =============================================================================
# CONTRACT ADDRESSES - MAINNETS
# =============================================================================
# NOTE: Mainnet contracts not deployed yet - these are placeholders
# Update with actual deployment addresses when available

# ETHEREUM MAINNET (ChainID: 1)
# ETHEREUM_MAINNET_IDENTITY_ADDRESS=0x0000000000000000000000000000000000000000
# ETHEREUM_MAINNET_REPUTATION_ADDRESS=0x0000000000000000000000000000000000000000
# ETHEREUM_MAINNET_VALIDATION_ADDRESS=0x0000000000000000000000000000000000000000
# ETHEREUM_MAINNET_START_BLOCK=0

# BASE MAINNET (ChainID: 8453)
# BASE_MAINNET_IDENTITY_ADDRESS=0x0000000000000000000000000000000000000000
# BASE_MAINNET_REPUTATION_ADDRESS=0x0000000000000000000000000000000000000000
# BASE_MAINNET_VALIDATION_ADDRESS=0x0000000000000000000000000000000000000000
# BASE_MAINNET_START_BLOCK=0

# LINEA MAINNET (ChainID: 59144)
# LINEA_MAINNET_IDENTITY_ADDRESS=0x0000000000000000000000000000000000000000
# LINEA_MAINNET_REPUTATION_ADDRESS=0x0000000000000000000000000000000000000000
# LINEA_MAINNET_VALIDATION_ADDRESS=0x0000000000000000000000000000000000000000
# LINEA_MAINNET_START_BLOCK=0

# =============================================================================
# ADDITIONAL CHAINS (Not configured in Ponder yet)
# =============================================================================
# Hedera Testnet
# HEDERA_TESTNET_IDENTITY_ADDRESS=0x4c74ebd72921d537159ed2053f46c12a7d8e5923
# HEDERA_TESTNET_REPUTATION_ADDRESS=0xc565edcba77e3abeade40bfd6cf6bf583b3293e0
# HEDERA_TESTNET_VALIDATION_ADDRESS=0x18df085d85c586e9241e0cd121ca422f571c2da6

# HyperEVM Testnet
# HYPEREVM_TESTNET_IDENTITY_ADDRESS=0x8004A9560C0edce880cbD24Ba19646470851C986
# HYPEREVM_TESTNET_REPUTATION_ADDRESS=0x8004b490779A65D3290a31fD96471122050dF671
# HYPEREVM_TESTNET_VALIDATION_ADDRESS=0x8004C86198fdB8d8169c0405D510EC86cc7B0551

# SKALE Base Sepolia Testnet
# SKALE_TESTNET_IDENTITY_ADDRESS=0x4fa7900596c9830664406d3796952c59ec4133d9
# SKALE_TESTNET_REPUTATION_ADDRESS=0x9b9d23a47697691ef1016906d1f8ddfc009e6a69
# SKALE_TESTNET_VALIDATION_ADDRESS=0x34ae1196b1609e01ebc90b75c802b2ea87203f13

# =============================================================================
# TELEGRAM (Optional - for action notifications)
# =============================================================================
# TELEGRAM_BOT_TOKEN=your_telegram_bot_token
# TELEGRAM_DEFAULT_CHAT_ID=your_chat_id

# =============================================================================
# DISCOVERY ENDPOINT CONFIGURATION
# =============================================================================
# Base URL for the API (used in discovery endpoint)
BASE_URL=https://api.8004.dev

# Contact information (exposed in /.well-known/agent.json)
CONTACT_EMAIL=support@8004.dev
CONTACT_GITHUB=https://github.com/erc-8004/api.8004.dev
DOCUMENTATION_URL=https://docs.8004.dev

# =============================================================================
# HTTPS/TLS CONFIGURATION (Production)
# =============================================================================
# Domain name for SSL certificate
DOMAIN=api.8004.dev

# Email for Let's Encrypt certificate notifications (REQUIRED for production)
# Let's Encrypt will send expiry warnings and important updates to this email
LETSENCRYPT_EMAIL=admin@8004.dev

# Enable HTTPS (set to "true" in production, "false" in development)
ENABLE_HTTPS=false

# TLS certificate renewal settings
# Certificate auto-renewal runs every 12 hours via certbot container
# Certificates are renewed when <30 days remain until expiry
# Manual renewal: docker compose --profile production run --rm certbot renew

# =============================================================================
# MONITORING (Optional)
# =============================================================================
# PROMETHEUS_ENABLED=true
# GRAFANA_ADMIN_PASSWORD=your_grafana_password
